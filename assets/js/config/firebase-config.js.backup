/**
 * Firebase ì„¤ì • íŒŒì¼ (ìˆ˜ì •ëœ ë²„ì „)
 * ì´ íŒŒì¼ì€ Firebase SDKë¥¼ ì´ˆê¸°í™”í•˜ê³  í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.
 */

// Firebase ì„¤ì • ì •ë³´ (ì‹¤ì œ í”„ë¡œì íŠ¸ ì •ë³´ë¡œ ìˆ˜ì •)
const firebaseConfig = {
  apiKey: "AIzaSyCnQBH5MxaFhraVPCk7awHOLO8j5C6Lw0A",
  authDomain: "digital-healthcare-cente-2204b.firebaseapp.com",
  projectId: "digital-healthcare-cente-2204b",
  storageBucket: "digital-healthcare-cente-2204b.firebasestorage.app",
  messagingSenderId: "60835775420",
  appId: "1:60835775420:web:7ae13d485fa19fd2f221b9",
  measurementId: "G-HXQ9SMCCFE"
};

// ğŸ”§ Firebase ì´ˆê¸°í™” ì „ ì²´í¬
if (typeof firebase === 'undefined') {
  console.error('âŒ Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. HTMLì—ì„œ Firebase SDK ìŠ¤í¬ë¦½íŠ¸ê°€ ë¨¼ì € ë¡œë“œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
} else {
  console.log('âœ… Firebase SDK ë¡œë“œ í™•ì¸ë¨');
}

// Firebase ì´ˆê¸°í™”
try {
  // ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
  if (firebase.apps.length === 0) {
    firebase.initializeApp(firebaseConfig);
    console.log("âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ");
  } else {
    console.log("âœ… Firebase ì´ë¯¸ ì´ˆê¸°í™”ë¨");
  }
} catch (error) {
  console.error("âŒ Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
}

// Analytics ì´ˆê¸°í™” (Analytics ì‚¬ìš© ì‹œ)
if (firebase.analytics && typeof firebase.analytics === 'function') {
  try {
    firebase.analytics();
    console.log("âœ… Firebase Analytics ì´ˆê¸°í™” ì„±ê³µ");
  } catch (error) {
    console.error("âŒ Firebase Analytics ì´ˆê¸°åŒ– ì˜¤ë¥˜:", error);
  }
}

// dhcFirebase ì „ì—­ ê°ì²´ ìƒì„± (ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹)
window.dhcFirebase = {
  auth: firebase.auth(),
  db: firebase.firestore(),
  storage: firebase.storage(),
  firebase: firebase,
  
  // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
  onAuthStateChanged: function(callback) {
    return firebase.auth().onAuthStateChanged(callback);
  },
  
  // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´
  getCurrentUser: function() {
    return firebase.auth().currentUser;
  },
  
  // ğŸ”§ ìˆ˜ì •: Firebase ì—°ê²° ìƒíƒœ í™•ì¸ í•¨ìˆ˜
  isConnected: function() {
    try {
      return firebase.apps.length > 0 && 
             typeof this.auth !== 'undefined' && 
             typeof this.db !== 'undefined';
    } catch (error) {
      console.error('Firebase ì—°ê²° ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
      return false;
    }
  }
};

console.log("âœ… Firebase dhcFirebase ê°ì²´ ìƒì„± ì™„ë£Œ");

// ğŸ”§ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ (ì˜¤ë¥˜ ì²˜ë¦¬ ê°œì„ )
try {
  if (window.dhcFirebase.isConnected()) {
    console.log("âœ… Firebase ì„œë¹„ìŠ¤ ì—°ê²° ìƒíƒœ:");
    console.log("  - Auth:", !!window.dhcFirebase.auth);
    console.log("  - Firestore:", !!window.dhcFirebase.db);
    console.log("  - Storage:", !!window.dhcFirebase.storage);
  } else {
    console.warn("âš ï¸ Firebase ì„œë¹„ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
  }
} catch (error) {
  console.error("âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:", error);
}

// ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ í”Œë˜ê·¸
// ì‹¤ì œ Firebaseë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì´ í”Œë˜ê·¸ë¥¼ falseë¡œ ì„¤ì •
window.LOCAL_TEST_MODE = false;

// Firebase Authentication ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹…
window.dhcFirebase.onAuthStateChanged(function(user) {
  if (user) {
    console.log("ğŸ” Firebase ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì¸ë¨", {
      uid: user.uid,
      email: user.email,
      displayName: user.displayName,
      emailVerified: user.emailVerified
    });
  } else {
    console.log("ğŸ” Firebase ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒë¨");
  }
});

// ğŸ”§ ì¶”ê°€: Firestore ì—°ê²° í™•ì¸
window.dhcFirebase.db.enableNetwork().then(() => {
  console.log("âœ… Firestore ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™œì„±í™”ë¨");
}).catch((error) => {
  console.warn("âš ï¸ Firestore ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜:", error);
});